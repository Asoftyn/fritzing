<html xmlns="http://www.w3.org/1999/xhtml" xmlns:tal="http://xml.zope.org/namespaces/tal" xmlns:metal="http://xml.zope.org/namespaces/metal" xmlns:i18n="http://xml.zope.org/namespaces/i18n" xml:lang="en" lang="en" metal:use-macro="context/main_template/macros/master" i18n:domain="fritzing.fab">
  <head>
    <metal:block fill-slot="style_slot" tal:define="navroot context/@@plone_portal_state/navigation_root_url">
      <link rel="stylesheet" type="text/css" tal:attributes="href string:${navroot}/++resource++fritzing.fab/styles.css"/>
    </metal:block>
    <metal:block fill-slot="javascript_head_slot" tal:define="navroot context/@@plone_portal_state/navigation_root_url">
      <script type="text/javascript" tal:attributes="src string:${navroot}/++resource++fritzing.fab/fab.js">
      </script>
    </metal:block>
  </head>
  <body>
    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main" tal:define="navroot context/@@plone_portal_state/navigation_root_url">
            <div>
              <h2>Current orders (round <span tal:replace="context/currentProductionRound"/>)</h2>
              <p>Orders with status "in process" since <span tal:replace="context/currentProductionOpeningDate"/></p>
              <p><a href="@@currentorders-csv">Download as CSV</a> -- <a href="@@currentorders-zip">Download as ZIP</a></p>
              <table class="orderTable" style="width: 100%; text-align: center; font-size: 80%;">
                <thead>
                  <tr>
                    <th>round</th>
                    <th>date</th>
                    <th>order-id</th>
                    <th>filename</th>
                    <th>count</th>
                    <th>optional</th>
                    <th>boards</th>
                    <th>size</th>
                    <th>price</th>
                    <th>paid</th>
                    <th>checked</th>
                    <th>invoiced</th>
                    <th>publishable</th>
                    <th>username</th>
                    <th>address</th>
                    <th>e-mail</th>
                    <th>zone</th>
                    <th>actions</th>
                  </tr>
                </thead>
                <tbody tal:define="DateTime python:modules['DateTime'].DateTime">
                  <div tal:repeat="brain python:view.getCurrentOrders(context)" tal:omit-tag="">
                    <div tal:define="order brain/getObject" tal:omit-tag="">
                        <tr tal:repeat="sketch order/listFolderContents">
                          <td tal:content="order/productionRound | string:error">production round</td>
                          <td tal:content="python: DateTime(order.Date()).strftime('%y-%m-%d %H:%M:%S')">date</td>
                          <td><a tal:attributes="href string:${order/absolute_url}" tal:content="order/id | string:error">order-id</a></td>
                          <td>
                                <a tal:define="filename sketch/orderItem/filename;                                              
                                               filename_encoded python:view.encodeFilename(filename);"
                                   tal:content="python: order.id + '_' + filename_encoded"
                                   tal:attributes="href string:${sketch/absolute_url}/@@download/orderItem/${filename_encoded};                                                  
                                                   title string:Download ${filename}"/>
                          </td>
                          <td tal:content="sketch/copies">copies</td>
                          <td></td>
                          <td tal:content="python:len(sketch.boards)">boards</td>
                          <td tal:content="python: '%.2f' % sketch.area">size</td>
                          <td tal:content="python: '%.2f' % (sketch.copies * sketch.area * order.pricePerSquareCm + 4.0)">price</td>
                          <td><span tal:condition="order/paid" tal:replace="order/paid | string:error"/></td>
                          <td><span tal:condition="order/checked" tal:replace="order/checked | string:error"/></td>
                          <td><span tal:condition="order/invoiced" tal:replace="order/invoiced | string:error"/></td>
                          <td><span tal:condition="sketch/publishable" tal:replace="sketch/publishable | string:error"/></td>
                          <td tal:content="order/getOwner | string:error">owner</td>
                          <td>
                            <span tal:replace="order/shippingCompany | nothing"/><br tal:condition="order/shippingCompany | nothing"/>
                            <span tal:replace="order/shippingFirstName | nothing"/> <span tal:replace="order/shippingLastName"/><br/>
                            <span tal:replace="order/shippingStreet | nothing"/><br/>
                            <span tal:replace="order/shippingAdditional | nothing"/><br tal:condition="order/shippingAdditional | nothing"/>
                            <span tal:replace="order/shippingZIP | nothing"/> <span tal:replace="order/shippingCity | nothing"/><br/>
                            <span tal:replace="python: view.getShippingCountry(order.shippingCountry)"/>
                          </td>
                          <td tal:content="order/email | string:error">email</td>
                          <td tal:content="order/shipTo| string:error">zone</td>
                          <td>
                            <a class="viewOrderLink" tal:attributes="href string:${order/absolute_url}">view</a>
                            <a class="viewOrderLink" tal:attributes="href string:${order/absolute_url}/edit">edit</a> 
                          </td>
                        </tr>
                    </div>
                  </div>
                </tbody>
              </table>
            </div>
      </tal:main-macro>
    </metal:main>
  </body>
</html>
